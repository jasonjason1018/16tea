!async function(){const a=document.querySelector("#audio");$("[data-voice]").on("click",function(){"open"===$(this).data("voice")&&a.play(),t.play()});let s={},w=0;$("[data-item]").each((a,t)=>{var e=$(t).data("item"),i=Math.floor(2*Math.random())+1;s[e]=i,w+=i,$(t).find("[data-target]").text(i)}),$("[data-task-num]").each((a,t)=>{var e=$(t).data("taskNum");$(t).text(s[e])});let v=0;const t=gsap.timeline();t.pause(),t.to(".intro-item",{opacity:1,duration:.5,delay:.3,stagger:.1});const e=gsap.timeline();e.pause(),e.to(".card.-task",{opacity:1,duration:.5}).to(".card.-task .card-wrap",{opacity:1,scale:1,duration:1,ease:"back.out(2)"});const i=gsap.timeline({repeat:-1});i.pause(),i.to(".instruction-finger.-c",{x:0,y:0,duration:1}).to(".instruction-finger.-c",{scale:.8,duration:.2}).to(".instruction-finger.-c>div",{opacity:1,duration:.2},"<").to(".instruction-finger.-c",{scale:1,duration:.2}).to(".instruction-click>img",{scale:1.2,duration:.2},"<").to(".instruction-click>img",{scale:1.1,duration:.2}).to(".instruction-click>img",{opacity:0,duration:.4});const o=gsap.timeline({repeat:-1});o.pause(),o.to(".instruction-finger.-l",{x:0,y:0,duration:1}).to(".instruction-finger.-l",{y:"-20%",rotate:20,duration:.2}).to(".instruction-finger.-l>div",{opacity:1,rotate:-20,duration:.2},"<").to(".instruction-leaf>img",{y:"-60%",rotate:40,opacity:0,duration:.8});let n=30,d=null,x=!1;function I(){clearInterval(d),x=!1,d=null,function(){$("body").addClass("-isPopupOpen"),w===v?($('[data-popup="success"]').addClass("-show"),$("body").addClass("-success")):($('[data-popup="fail"]').addClass("-show"),$("body").addClass("-fail")),$("[data-found]").text(v),$("[data-notfound]").text(w-v);var a=v/w;let t="A",e="差點就成為S級收集達人！\n再試一次！";1==a&&(t="S",e="十六食穀收集達人非你莫屬！"),a<.5&&(t="B",e="還有好多食穀沒找到耶~\n再試試吧 !"),$(".score-level").addClass(`-${t}`).find("div").text(t),$(".score-desc").text(e)}()}const C=new PIXI.Application;await C.init({backgroundAlpha:0,resizeTo:document.querySelector("#canvas-container"),resolution:window.devicePixelRatio||1,autoDensity:!0,antialias:!0}),document.querySelector("#canvas-container").appendChild(C.view);var c=async a=>{let{x:t,y:e,width:i,height:o,imgName:n,hitArea:s}=a;var d=n.split("-")[0];const r=new PIXI.Container;r.x=t+.5*i,r.y=e+.5*o,C.stage.addChild(r);var c,l,a=await PIXI.Assets.load(`/assets/image/map${mapNum}/game/items/${n}.png`);const u=new PIXI.Sprite(a);u.anchor.set(.5),u.eventMode="static",u.cursor="pointer",0<s.length&&(c=-.5*i,l=-.5*o,p=s.map((a,t)=>t%2==0?a+c:a+l),u.hitArea=new PIXI.Polygon(p)),u.on("pointerdown",()=>{x&&("coffee"!==d?(u.eventMode="none",score[d]++,v++,$(`[data-item="${d}"]`).find("[data-num]").text(score[d]),m.play(),w===v&&setTimeout(()=>{I()},1e3),g.play()):($(".game-stage").addClass("-coffee"),g.restart()))});var p=await PIXI.Assets.load(`/assets/image/map${mapNum}/game/original/${n}.png`);const h=new PIXI.Sprite(p);h.anchor.set(.5),h.alpha=0,r.addChild(u),r.addChild(h);const m=gsap.timeline();m.pause();const g=gsap.timeline();if(g.pause(),"coffee"!==d){var f=await PIXI.Assets.load("/assets/image/other/add.png");const y=new PIXI.Sprite(f);y.x=t+.5*i-55,y.y=e-86,y.alpha=0,m.to(y,{alpha:1,duration:.3}).to(y,{alpha:0,duration:.3,delay:.3}),C.stage.addChild(y),g.to(r.scale,{x:1.3,y:1.3,duration:.5,ease:"back.out(4)"}).to(h,{alpha:1,duration:.5},"<").to(r,{alpha:0,duration:.3,delay:.2})}else{p=t-10+.5*i,f=t+10+.5*i;g.to(h,{alpha:1,duration:.1}).to(r,{x:p,duration:.1},"<").to(r,{x:f,duration:.1}).to(r,{x:p,duration:.1}).to(r,{x:f,duration:.1}).to(r,{x:p,duration:.1}).to(r,{x:f,duration:.1}).to(r,{x:t+.5*i,duration:.1})}},l=async a=>{var{x:t,y:e,width:i,height:o,imgName:a}=a,a=await PIXI.Assets.load(`/assets/image/map${mapNum}/game/leaf/${a}.png`);const n=new PIXI.Sprite(a);n.anchor.set(1,1),n.x=t+i,n.y=e+o,n.eventMode="static",n.on("pointerdown",()=>{n.eventMode="none",s.play()}),C.stage.addChild(n);const s=gsap.timeline();s.pause(),s.to(n,{y:e+o-100,rotation:Math.PI/180*40,alpha:0,duration:.6})};function r(){var a=document.querySelector("#canvas-container").offsetWidth;C.stage.scale.set(a/1170)}fetch(`/assets/image/map${mapNum}/game/data.json`).then(a=>a.json()).then(a=>{Object.entries(a.items).forEach(a=>{var[d,t]=a;const r=[1,2,3,4].sort(()=>Math.random()-.5).slice(0,s[d]).map(a=>a-1);r.map(a=>t[a]).forEach((a,t)=>{const{x:e,y:i,width:o,height:n,hitArea:s}=a;t=`${d}-${r[t]+1}`;if(c({x:e,y:i,width:o,height:n,imgName:t,hitArea:s}),a.leaf){const{x:e,y:i,width:o,height:n}=a.leaf;l({x:e,y:i,width:o,height:n,imgName:t})}})});const{x:t,y:e,width:i,height:o,hitArea:n}=a.coffee;if(c({x:t,y:e,width:i,height:o,imgName:"coffee",hitArea:n}),a.coffee.leaf){const{x:t,y:e,width:i,height:o}=a.coffee.leaf;l({x:t,y:e,width:i,height:o,imgName:"coffee"})}}),window.addEventListener("resize",()=>{r()}),r(),$("[data-step-btn]").on("click.step",function(){var a=$(this).data("stepBtn");switch($("[data-step]").removeClass("-active"),$(`[data-step="${a}"]`).addClass("-active"),a){case"task":e.play(),$(".main").hasClass("-f01")&&$(".header-subject").fadeOut(150,function(){$(".header-subject img").attr("src","/assets/image/layout/subject-wt.png"),$(".header-subject").fadeIn(150)});break;case"instruction":$(".header-logo").addClass("-hide"),i.play(),o.play();break;case"game":setTimeout(()=>{null===d&&(x=!0,d=setInterval(()=>{n--,$("[data-second]").text(n),n<=0&&I()},1e3))},500);break;case"level":$(".header-subject img").attr("src","/assets/image/layout/subject-dk.png"),$(".header-logo").removeClass("-hide")}}),$(window).on("allLoaded",function(){$("body").hasClass("-wrongBrowser")||$('[data-popup="music"]').hasClass("-show")||t.play()})}();
//# sourceMappingURL=game.min.js.map
