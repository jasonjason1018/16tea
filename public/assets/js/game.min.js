!async function(){const a=document.querySelector("#audio");$("[data-voice]").on("click.voice",function(){var t=$(this).attr("data-voice");$("[data-voice]").attr("data-voice","on"===t?"off":"on"),"off"===(t=$("[data-voice]").attr("data-voice"))?a.play():"on"===t&&a.pause(),0<$(this).closest(".popup").length&&e.play()});let n={},v=0;$("[data-item]").each((t,a)=>{var e=$(a).data("item"),o=Math.floor(2*Math.random())+1;n[e]=o,v+=o,$(a).find("[data-target]").text(o)}),$("[data-task-num]").each((t,a)=>{var e=$(a).data("taskNum");$(a).text(n[e])});let w=0;const e=gsap.timeline();e.pause(),e.to(".intro-item",{opacity:1,duration:.5,delay:.3,stagger:.1});const o=gsap.timeline();o.pause(),o.to(".card.-task",{opacity:1,duration:.5}).to(".card.-task .card-wrap",{opacity:1,scale:1,duration:1,ease:"back.out(2)"});const i=gsap.timeline({repeat:-1});i.pause(),i.to(".instruction-finger.-c",{x:0,y:0,duration:1}).to(".instruction-finger.-c",{scale:.8,duration:.2}).to(".instruction-finger.-c>div",{opacity:1,duration:.2},"<").to(".instruction-finger.-c",{scale:1,duration:.2}).to(".instruction-click>img",{scale:1.2,duration:.2},"<").to(".instruction-click>img",{scale:1.1,duration:.2}).to(".instruction-click>img",{opacity:0,duration:.4});const s=gsap.timeline({repeat:-1});s.pause(),s.to(".instruction-finger.-l",{x:0,y:0,duration:1}).to(".instruction-finger.-l",{y:"-20%",rotate:20,duration:.2}).to(".instruction-finger.-l>div",{opacity:1,rotate:-20,duration:.2},"<").to(".instruction-leaf>img",{y:"-60%",rotate:40,opacity:0,duration:.8});let d=30,c=null,x=!1;function I(){clearInterval(c),x=!1,c=null,function(){$("body").addClass("-isPopupOpen"),v===w?($('[data-popup="success"]').addClass("-show"),$("body").addClass("-success")):($('[data-popup="fail"]').addClass("-show"),$("body").addClass("-fail")),$("[data-found]").text(w),$("[data-notfound]").text(v-w);var t=w/v;let a="A",e="差點就成為S級收集達人！\n再試一次！";1==t&&(a="S",e="十六食穀收集達人非你莫屬！"),t<.5&&(a="B",e="還有好多食穀沒找到耶~\n再試試吧 !"),scoreLevel=a,$(".score-level").addClass(`-${a}`).find("div").text(a),$(".score-desc").text(e)}()}const C=new PIXI.Application;await C.init({backgroundAlpha:0,resizeTo:document.querySelector("#canvas-container"),resolution:window.devicePixelRatio||1,autoDensity:!0,antialias:!0}),document.querySelector("#canvas-container").appendChild(C.view);var r=async t=>{let{x:a,y:e,width:o,height:i,imgName:s,hitArea:n}=t;var d=s.split("-")[0];const c=new PIXI.Container;c.x=a+.5*o,c.y=e+.5*i,C.stage.addChild(c);var r,l,t=await PIXI.Assets.load(`/assets/image/map${mapNum}/game/items/${s}.png`);const u=new PIXI.Sprite(t);u.anchor.set(.5),u.eventMode="static",u.cursor="pointer",0<n.length&&(r=-.5*o,l=-.5*i,p=n.map((t,a)=>a%2==0?t+r:t+l),u.hitArea=new PIXI.Polygon(p)),u.on("pointerdown",()=>{x&&("coffee"!==d?(u.eventMode="none",score[d]++,w++,$(`[data-item="${d}"]`).find("[data-num]").text(score[d]),m.play(),v===w&&setTimeout(()=>{I()},1e3),g.play()):($(".game-stage").addClass("-coffee"),g.restart()))});var p=await PIXI.Assets.load(`/assets/image/map${mapNum}/game/original/${s}.png`);const h=new PIXI.Sprite(p);h.anchor.set(.5),h.alpha=0,c.addChild(u),c.addChild(h);const m=gsap.timeline();m.pause();const g=gsap.timeline();if(g.pause(),"coffee"!==d){var f=await PIXI.Assets.load("/assets/image/other/add.png");const y=new PIXI.Sprite(f);y.x=a+.5*o-55,y.y=e-86,y.alpha=0,m.to(y,{alpha:1,duration:.3}).to(y,{alpha:0,duration:.3,delay:.3}),C.stage.addChild(y),g.to(c.scale,{x:1.3,y:1.3,duration:.5,ease:"back.out(4)"}).to(h,{alpha:1,duration:.5},"<").to(c,{alpha:0,duration:.3,delay:.2})}else{p=a-10+.5*o,f=a+10+.5*o;g.to(h,{alpha:1,duration:.1}).to(c,{x:p,duration:.1},"<").to(c,{x:f,duration:.1}).to(c,{x:p,duration:.1}).to(c,{x:f,duration:.1}).to(c,{x:p,duration:.1}).to(c,{x:f,duration:.1}).to(c,{x:a+.5*o,duration:.1,onComplete:()=>{setTimeout(()=>{$(".game-stage").removeClass("-coffee")},500)}})}},l=async t=>{var{x:a,y:e,width:o,height:i,imgName:t}=t,t=await PIXI.Assets.load(`/assets/image/map${mapNum}/game/leaf/${t}.png`);const s=new PIXI.Sprite(t);s.anchor.set(1,1),s.x=a+o,s.y=e+i,s.eventMode="static",s.on("pointerdown",()=>{s.eventMode="none",n.play()}),C.stage.addChild(s);const n=gsap.timeline();n.pause(),n.to(s,{y:e+i-100,rotation:Math.PI/180*40,alpha:0,duration:.6})};function t(){var t=document.querySelector("#canvas-container").offsetWidth;C.stage.scale.set(t/1170)}fetch(`/assets/image/map${mapNum}/game/data.json`).then(t=>t.json()).then(t=>{Object.entries(t.items).forEach(t=>{var[d,a]=t;const c=[1,2,3,4].sort(()=>Math.random()-.5).slice(0,n[d]).map(t=>t-1);c.map(t=>a[t]).forEach((t,a)=>{const{x:e,y:o,width:i,height:s,hitArea:n}=t;a=`${d}-${c[a]+1}`;if(r({x:e,y:o,width:i,height:s,imgName:a,hitArea:n}),t.leaf){const{x:e,y:o,width:i,height:s}=t.leaf;l({x:e,y:o,width:i,height:s,imgName:a})}})});const{x:a,y:e,width:o,height:i,hitArea:s}=t.coffee;if(r({x:a,y:e,width:o,height:i,imgName:"coffee",hitArea:s}),t.coffee.leaf){const{x:a,y:e,width:o,height:i}=t.coffee.leaf;l({x:a,y:e,width:o,height:i,imgName:"coffee"})}}),window.addEventListener("resize",()=>{t()}),t(),$("[data-step-btn]").on("click.step",function(){var t=$(this).data("stepBtn");switch($("[data-step]").removeClass("-active"),$(`[data-step="${t}"]`).addClass("-active"),t){case"task":o.play(),$(".main").hasClass("-f01")&&$(".header-subject").fadeOut(150,function(){$(".header-subject img").attr("src","/assets/image/layout/subject-wt.png"),$(".header-subject").fadeIn(150)});break;case"instruction":$(".header-logo").addClass("-hide"),i.play(),s.play();break;case"game":setTimeout(()=>{null===c&&(x=!0,c=setInterval(()=>{d--,$("[data-second]").text(d),d<=0&&I()},1e3))},500);break;case"level":$(".header-subject img").attr("src","/assets/image/layout/subject-dk.png"),$(".header-logo").removeClass("-hide")}}),$(window).on("allLoaded",function(){$("body").hasClass("-wrongBrowser")||$('[data-popup="music"]').hasClass("-show")||e.play()})}();
//# sourceMappingURL=game.min.js.map
