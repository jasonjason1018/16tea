{"version":3,"sources":["assets/js/game.js"],"names":["audio","document","querySelector","$","on","state","this","attr","play","pause","closest","length","introTl","targetData","targetScore","each","i","el","id","data","num","Math","floor","random","find","text","currentScore","gsap","timeline","to","opacity","duration","delay","stagger","taskTl","scale","ease","clickTl","repeat","x","y","leafTl","rotate","second","timer","isStart","endTimer","clearInterval","addClass","percent","level","txt","scoreLevel","gameEnd","app","PIXI","Application","init","backgroundAlpha","resizeTo","resolution","window","devicePixelRatio","autoDensity","antialias","appendChild","view","createItem","_ref","width","height","imgName","hitArea","name","split","container","Container","stage","addChild","offsetX","offsetY","itemTexture","Assets","load","mapNum","item","Sprite","anchor","set","eventMode","cursor","points","map","val","Polygon","score","addTl","setTimeout","itemTl","restart","originalTexture","original","alpha","addTexture","add","shakeLeft","shakeRight","onComplete","removeClass","createLeaf","_ref2","leafTexture","leaf","rotation","PI","stageResize","canvasW","offsetWidth","fetch","then","res","json","Object","entries","items","forEach","_ref3","key","value","randomIndex","sort","slice","coffee","addEventListener","hasClass","fadeOut","fadeIn","setInterval"],"mappings":"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","file":"game.min.js","sourcesContent":["(async function () {\n    // 音樂\n    const audio = document.querySelector('#audio');\n\n    function toggleMusic() {\n        var state = $('[data-voice]').attr('data-voice');\n\n        if (state === 'off') {\n            audio.play();\n        } else if (state === 'on') {\n            audio.pause();\n        }\n    }\n    $('[data-voice]').on('click.voice', function () {\n        var state = $(this).attr('data-voice');\n        $('[data-voice]').attr('data-voice', state === 'on' ? 'off' : 'on');\n        toggleMusic();\n        if ($(this).closest('.popup').length > 0) {\n            introTl.play();\n        }\n    });\n\n    // 取得隨機目標數量(1-2個)\n    let targetData = {};\n    let targetScore = 0;\n    $('[data-item]').each((i, el) => {\n        const id = $(el).data('item');\n        const num = Math.floor(Math.random() * 2) + 1;\n        targetData[id] = num;\n        targetScore += num;\n        $(el).find('[data-target]').text(num);\n    });\n    $('[data-task-num]').each((i, el) => {\n        const id = $(el).data('taskNum');\n        $(el).text(targetData[id]);\n    });\n    let currentScore = 0;\n\n    // 介紹進場動畫\n    const introTl = gsap.timeline();\n    introTl.pause();\n    introTl\n        .to('.intro-item', {\n            opacity: 1,\n            duration: 0.5,\n            delay: 0.3,\n            stagger: 0.1,\n        });\n\n    // 指定進場動畫\n    const taskTl = gsap.timeline();\n    taskTl.pause();\n    taskTl\n        .to('.card.-task', {\n            opacity: 1,\n            duration: 0.5\n        })\n        .to('.card.-task .card-wrap', {\n            opacity: 1,\n            scale: 1,\n            duration: 1,\n            ease: 'back.out(2)'\n        });\n\n    // 說明進場動畫(點擊物件)\n    const clickTl = gsap.timeline({\n        repeat: -1\n    });\n    clickTl.pause();\n    clickTl\n        .to('.instruction-finger.-c', {\n            x: 0,\n            y: 0,\n            duration: 1,\n        })\n        .to('.instruction-finger.-c', {\n            scale: 0.8,\n            duration: 0.2,\n        })\n        .to('.instruction-finger.-c>div', {\n            opacity: 1,\n            duration: 0.2,\n        }, '<')\n        .to('.instruction-finger.-c', {\n            scale: 1,\n            duration: 0.2,\n        })\n        .to('.instruction-click>img', {\n            scale: 1.2,\n            duration: 0.2,\n        }, '<')\n        .to('.instruction-click>img', {\n            scale: 1.1,\n            duration: 0.2,\n        })\n        .to('.instruction-click>img', {\n            opacity: 0,\n            duration: 0.4,\n        });\n    // 說明進場動畫(撥開葉子)\n    const leafTl = gsap.timeline({\n        repeat: -1\n    });\n    leafTl.pause();\n    leafTl\n        .to('.instruction-finger.-l', {\n            x: 0,\n            y: 0,\n            duration: 1,\n        })\n        .to('.instruction-finger.-l', {\n            y: '-20%',\n            rotate: 20,\n            duration: 0.2,\n        })\n        .to('.instruction-finger.-l>div', {\n            opacity: 1,\n            rotate: -20,\n            duration: 0.2,\n        }, '<')\n        .to('.instruction-leaf>img', {\n            y: '-60%',\n            rotate: 40,\n            opacity: 0,\n            duration: 0.8,\n        });\n\n    // 計時器\n    let second = 30;\n    let timer = null;\n    let isStart = false;\n\n    // 計時開始\n    function startTimer() {\n        if (timer !== null) return; // 避免重複開始\n\n        isStart = true;\n        timer = setInterval(() => {\n            second--;\n            $('[data-second]').text(second);\n\n            if (second <= 0) endTimer();\n        }, 1000);\n    }\n\n    function endTimer() {\n        clearInterval(timer);\n        isStart = false;\n        timer = null;\n        gameEnd();\n    }\n\n    // 創建遊戲舞台\n    const app = new PIXI.Application();\n    await app.init({\n        // width: 1170,\n        // height: 1624,\n        backgroundAlpha: 0,\n        resizeTo: document.querySelector('#canvas-container'),\n        resolution: window.devicePixelRatio || 1,\n        autoDensity: true,\n        antialias: true\n    });\n    document.querySelector('#canvas-container').appendChild(app.view);\n\n    // 新增物件\n    const createItem = async ({ x, y, width, height, imgName, hitArea }) => {\n        const name = imgName.split('-')[0];\n\n        const container = new PIXI.Container();\n        container.x = x + width * 0.5;\n        container.y = y + height * 0.5;\n        app.stage.addChild(container);\n\n        const itemTexture = await PIXI.Assets.load(`/assets/image/map${mapNum}/game/items/${imgName}.png`);\n        const item = new PIXI.Sprite(itemTexture);\n        item.anchor.set(0.5);\n        item.eventMode = 'static';\n        item.cursor = 'pointer';\n        if (hitArea.length > 0) {\n            const offsetX = width * -0.5;\n            const offsetY = height * -0.5;\n            const points = hitArea.map((val, i) => i % 2 === 0 ? val + offsetX : val + offsetY);\n            item.hitArea = new PIXI.Polygon(points);\n\n            // const hitShape = new PIXI.Graphics();\n            // hitShape.beginFill(0xff0000, 0.3); // 紅色、30% 透明度\n            // hitShape.drawPolygon(hitArea);\n            // hitShape.endFill();\n            // hitShape.x = offsetX;\n            // hitShape.y = offsetY;\n            // container.addChild(hitShape);\n        }\n        item.on('pointerdown', () => {\n            if (!isStart) return;\n\n            if (name !== 'coffee') {\n                item.eventMode = 'none';\n\n                score[name]++;\n                currentScore++;\n                // $(`[data-item=\"${name}\"]`).addClass('-active').find('[data-num]').text(score[name]);\n                $(`[data-item=\"${name}\"]`).find('[data-num]').text(score[name]);\n                addTl.play();\n\n                if (targetScore === currentScore) {\n                    setTimeout(() => {\n                        endTimer();\n                    }, 1000);\n                }\n                itemTl.play();\n            } else {\n                $('.game-stage').addClass('-coffee');\n                itemTl.restart();\n            }\n        });\n\n        const originalTexture = await PIXI.Assets.load(`/assets/image/map${mapNum}/game/original/${imgName}.png`);\n        const original = new PIXI.Sprite(originalTexture);\n        original.anchor.set(0.5);\n        original.alpha = 0;\n\n        container.addChild(item);\n        container.addChild(original);\n\n        const addTl = gsap.timeline();\n        addTl.pause();\n\n        // 物件點擊動畫\n        const itemTl = gsap.timeline();\n        itemTl.pause();\n        if (name !== 'coffee') {\n            const addTexture = await PIXI.Assets.load(`/assets/image/other/add.png`);\n            const add = new PIXI.Sprite(addTexture);\n            add.x = x + (width * 0.5) - 55;\n            add.y = y - 86;\n            add.alpha = 0;\n            addTl\n                .to(add, {\n                    alpha: 1,\n                    duration: 0.3\n                })\n                .to(add, {\n                    alpha: 0,\n                    duration: 0.3,\n                    delay: 0.3\n                });\n            app.stage.addChild(add);\n\n            itemTl\n                .to(container.scale, {\n                    x: 1.3,\n                    y: 1.3,\n                    duration: 0.5,\n                    ease: 'back.out(4)'\n                })\n                .to(original, {\n                    alpha: 1,\n                    duration: 0.5\n                }, '<')\n                .to(container, {\n                    alpha: 0,\n                    duration: 0.3,\n                    delay: 0.2\n                });\n        } else {\n            const shakeLeft = x - 10 + width * 0.5;\n            const shakeRight = x + 10 + width * 0.5;\n            itemTl\n                .to(original, {\n                    alpha: 1,\n                    duration: 0.1\n                })\n                .to(container, {\n                    x: shakeLeft,\n                    duration: 0.1\n                }, '<')\n                .to(container, {\n                    x: shakeRight,\n                    duration: 0.1\n                })\n                .to(container, {\n                    x: shakeLeft,\n                    duration: 0.1\n                })\n                .to(container, {\n                    x: shakeRight,\n                    duration: 0.1\n                })\n                .to(container, {\n                    x: shakeLeft,\n                    duration: 0.1\n                })\n                .to(container, {\n                    x: shakeRight,\n                    duration: 0.1\n                })\n                .to(container, {\n                    x: x + width * 0.5,\n                    duration: 0.1,\n                    onComplete: () => {\n                        setTimeout(() => {\n                            $('.game-stage').removeClass('-coffee');\n                        }, 500);\n                    }\n                });\n        }\n    }\n    // 新增覆蓋葉子\n    const createLeaf = async ({ x, y, width, height, imgName }) => {\n        const leafTexture = await PIXI.Assets.load(`/assets/image/map${mapNum}/game/leaf/${imgName}.png`);\n        const leaf = new PIXI.Sprite(leafTexture);\n        leaf.anchor.set(1, 1);\n        leaf.x = x + width;\n        leaf.y = y + height;\n        leaf.eventMode = 'static';\n        leaf.on('pointerdown', () => {\n            leaf.eventMode = 'none';\n            leafTl.play();\n        });\n        app.stage.addChild(leaf);\n\n        // 葉子點擊動畫\n        const leafTl = gsap.timeline();\n        leafTl.pause();\n        leafTl\n            .to(leaf, {\n                y: y + height - 100,\n                rotation: 40 * (Math.PI / 180),\n                alpha: 0,\n                duration: 0.6\n            });\n    }\n\n    // 物件定位資料\n    fetch(`/assets/image/map${mapNum}/game/data.json`)\n        .then(res => res.json())\n        .then(data => {\n            Object.entries(data.items).forEach(([key, value]) => {\n                // 取得隨機序列資料\n                const randomIndex = [1, 2, 3, 4]\n                    .sort(() => Math.random() - 0.5)\n                    .slice(0, targetData[key])\n                    .map(i => i - 1);\n\n                randomIndex\n                    .map(i => value[i])\n                    .forEach((item, i) => {\n                        const { x, y, width, height, hitArea } = item;\n                        const imgName = `${key}-${randomIndex[i] + 1}`;\n                        createItem({ x, y, width, height, imgName, hitArea });\n\n                        // 若有葉子覆蓋\n                        if (item.leaf) {\n                            const { x, y, width, height } = item.leaf;\n                            createLeaf({ x, y, width, height, imgName });\n                        }\n                    });\n            });\n\n            // 新增陷阱咖啡豆\n            const { x, y, width, height, hitArea } = data.coffee;\n            createItem({ x, y, width, height, imgName: 'coffee', hitArea });\n            // 若咖啡豆有葉子覆蓋\n            if (data.coffee.leaf) {\n                const { x, y, width, height } = data.coffee.leaf;\n                createLeaf({ x, y, width, height, imgName: 'coffee' });\n            }\n        });\n\n    function gameEnd() {\n        $('body').addClass('-isPopupOpen');\n\n        if (targetScore === currentScore) {\n            $('[data-popup=\"success\"]').addClass('-show');\n            $('body').addClass('-success');\n        } else {\n            $('[data-popup=\"fail\"]').addClass('-show');\n            $('body').addClass('-fail');\n        }\n\n        $('[data-found]').text(currentScore);\n        $('[data-notfound]').text(targetScore - currentScore);\n\n        const percent = currentScore / targetScore;\n\n        let level = 'A';\n        let txt = '差點就成為S級收集達人！\\n再試一次！';\n\n        if (percent == 1) {\n            level = 'S'\n            txt = '十六食穀收集達人非你莫屬！';\n        };\n        if (percent < 0.5) {\n            level = 'B';\n            txt = '還有好多食穀沒找到耶~\\n再試試吧 !';\n        };\n\n        scoreLevel = level;\n\n        $('.score-level').addClass(`-${level}`).find('div').text(level);\n        $('.score-desc').text(txt);\n    }\n\n    window.addEventListener('resize', () => {\n        stageResize();\n    });\n    stageResize();\n    function stageResize() {\n        const canvasW = document.querySelector('#canvas-container').offsetWidth;\n        app.stage.scale.set(canvasW / 1170);\n    }\n\n    $('[data-step-btn]').on('click.step', function () {\n        const id = $(this).data('stepBtn');\n        $('[data-step]').removeClass('-active');\n        $(`[data-step=\"${id}\"]`).addClass('-active');\n\n        switch (id) {\n            case 'task':\n                taskTl.play();\n                if ($('.main').hasClass('-f01')) {\n                    $('.header-subject').fadeOut(150, function () {\n                        $('.header-subject img').attr('src', '/assets/image/layout/subject-wt.png');\n                        $('.header-subject').fadeIn(150);\n                    });\n                }\n                break;\n            case 'instruction':\n                $('.header-logo').addClass('-hide');\n                clickTl.play();\n                leafTl.play();\n                break;\n            case 'game':\n                setTimeout(() => {\n                    startTimer();\n                }, 500);\n                break;\n            case 'level':\n                $('.header-subject img').attr('src', '/assets/image/layout/subject-dk.png');\n                $('.header-logo').removeClass('-hide');\n                break;\n\n            default:\n                break;\n        }\n    });\n\n    $(window).on('allLoaded', function () {\n        if ($('body').hasClass('-wrongBrowser')) {\n            return;\n        }\n\n        if (!$('[data-popup=\"music\"]').hasClass('-show')) {\n            introTl.play();\n        }\n    });\n})();\n"],"sourceRoot":"/"}